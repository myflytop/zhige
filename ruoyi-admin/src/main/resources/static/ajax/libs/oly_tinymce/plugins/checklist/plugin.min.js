/*!
 * Tiny Checklist plugin
 *
 * Copyright (c) 2022 Ephox Corporation DBA Tiny Technologies, Inc.
 * Licensed under the Tiny commercial license. See https://www.tiny.cloud/legal/
 *
 * Version: 2.0.1-20
 */
!function(){"use strict";const t=t=>parseInt(t,10),e=(t,e)=>{const o=t-e;return 0===o?0:o>0?1:-1},o=(t,e,o)=>({major:t,minor:e,patch:o}),n=e=>{const n=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(e);return n?o(t(n[1]),t(n[2]),t(n[3])):o(0,0,0)},r=t=>e=>typeof e===t,s=t=>"string"===(t=>{const e=typeof t;return null===t?"null":"object"===e&&Array.isArray(t)?"array":"object"===e&&(o=n=t,(r=String).prototype.isPrototypeOf(o)||(null===(s=n.constructor)||void 0===s?void 0:s.name)===r.name)?"string":e;var o,n,r,s})(t),i=r("boolean"),c=t=>!(t=>null==t)(t),l=r("function"),a=r("number");class u{constructor(t,e){this.tag=t,this.value=e}static some(t){return new u(!0,t)}static none(){return u.singletonNone}fold(t,e){return this.tag?e(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?u.some(t(this.value)):u.none()}bind(t){return this.tag?t(this.value):u.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:u.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(null!=t?t:"Called getOrDie on None")}static from(t){return c(t)?u.some(t):u.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}u.singletonNone=new u(!1);const d=(!1,()=>false);const m=Array.prototype.indexOf,h=(t,e)=>{return o=t,n=e,m.call(o,n)>-1;var o,n},g=(t,e)=>{const o=t.length,n=new Array(o);for(let r=0;r<o;r++){const o=t[r];n[r]=e(o,r)}return n},f=(t,e)=>{for(let o=0,n=t.length;o<n;o++)e(t[o],o)},p=Object.keys;"undefined"!=typeof window?window:Function("return this;")();const v=t=>t.dom.nodeName.toLowerCase(),y=t=>e=>(t=>t.dom.nodeType)(e)===t,w=y(1),k=y(3),b=y(9),L=y(11),N=t=>e=>w(e)&&v(e)===t,x=(t,e,o)=>{if(!(s(o)||i(o)||a(o)))throw console.error("Invalid call to Attribute.set. Key ",e,":: Value ",o,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,o+"")},S=(t,e,o)=>{x(t.dom,e,o)},T=(t,e)=>{t.dom.removeAttribute(e)},C=(t,e)=>{const o=((t,e)=>{const o=t.dom.getAttribute(e);return null===o?void 0:o})(t,e);return void 0===o||""===o?[]:o.split(" ")},A=t=>void 0!==t.dom.classList,M=t=>C(t,"class"),O=(t,e)=>((t,e,o)=>{const n=C(t,e).concat([o]);return S(t,e,n.join(" ")),!0})(t,"class",e),j=(t,e)=>((t,e,o)=>{const n=((t,e)=>{const n=[];for(let e=0,r=t.length;e<r;e++){const r=t[e];r!==o&&n.push(r)}return n})(C(t,e));return n.length>0?S(t,e,n.join(" ")):T(t,e),!1})(t,"class",e),E=(t,e)=>{A(t)?t.dom.classList.add(e):O(t,e)},D=t=>{0===(A(t)?t.dom.classList:M(t)).length&&T(t,"class")},B=(t,e)=>{A(t)?t.dom.classList.remove(e):j(t,e),D(t)},I=(t,e)=>A(t)&&t.dom.classList.contains(e),P=t=>{if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},R=(t,e)=>{const o=(e||document).createElement(t);return P(o)},V=P,U=(t,e)=>{const o=t.dom;if(1!==o.nodeType)return!1;{const t=o;if(void 0!==t.matches)return t.matches(e);if(void 0!==t.msMatchesSelector)return t.msMatchesSelector(e);if(void 0!==t.webkitMatchesSelector)return t.webkitMatchesSelector(e);if(void 0!==t.mozMatchesSelector)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")}},X=t=>u.from(t.dom.parentNode).map(V),q=t=>g(t.dom.childNodes,V),z=t=>((t,e)=>{const o=t.dom.childNodes;return u.from(o[0]).map(V)})(t),F=l(Element.prototype.attachShadow)&&l(Node.prototype.getRootNode)?t=>V(t.dom.getRootNode()):t=>b(t)?t:V(t.dom.ownerDocument),K=t=>V(t.dom.host),Y=t=>{const e=k(t)?t.dom.parentNode:t.dom;if(null==e||null===e.ownerDocument)return!1;const o=e.ownerDocument;return(t=>{const e=F(t);return L(o=e)&&c(o.dom.host)?u.some(e):u.none();var o})(V(e)).fold((()=>o.body.contains(e)),(n=Y,r=K,t=>n(r(t))));var n,r},$=(t,e)=>({left:t,top:e,translate:(o,n)=>$(t+o,e+n)}),G=$,H=(t,e)=>void 0!==t?t:void 0!==e?e:0,J=t=>N("li")(t)&&X(t).filter((t=>"ul"===v(t)&&I(t,"tox-checklist"))).isSome(),Q=(t,e)=>e<(t=>{const e=t.dom.ownerDocument,o=e.body,n=e.defaultView,r=e.documentElement;if(o===t.dom)return G(o.offsetLeft,o.offsetTop);const s=H(null==n?void 0:n.pageYOffset,r.scrollTop),i=H(null==n?void 0:n.pageXOffset,r.scrollLeft),c=H(r.clientTop,o.clientTop),l=H(r.clientLeft,o.clientLeft);return(t=>{const e=t.dom,o=e.ownerDocument.body;return o===e?G(o.offsetLeft,o.offsetTop):Y(t)?(t=>{const e=t.getBoundingClientRect();return G(e.left,e.top)})(e):G(0,0)})(t).translate(i-l,s-c)})(t).left,W=t=>((t,e)=>{const o=A(t)?t.dom.classList.toggle(e):((t,e)=>h(M(t),e)?j(t,e):O(t,e))(t,e);return D(t),o})(t,"tox-checklist--checked"),Z=t=>h(["ul","ol","dl"],v(t)),_=t=>(u.from(t).filter((t=>I(t,"tox-checklist"))).bind(z).map((t=>{N("li")(t)&&z(t).exists(N("ul"))&&E(t,"tox-checklist--hidden")})),t);var tt=(t,e,o,n,r)=>t(o,n)?u.some(o):l(r)&&r(o)?u.none():e(o,n,r);const et=(t,e,o)=>{let n=t.dom;const r=l(o)?o:d;for(;n.parentNode;){n=n.parentNode;const t=V(n);if(e(t))return u.some(t);if(r(t))break}return u.none()},ot=(t,e)=>{t.dom.appendChild(e.dom)},nt=(t,e)=>{const o=((t,e)=>{const o=R(e),n=(r=t.dom.attributes,s=(t,e)=>(t[e.name]=e.value,t),i={},f(r,((t,e)=>{i=s(i,t)})),i);var r,s,i;return((t,e)=>{const o=t.dom;((t,e)=>{const o=p(t);for(let n=0,r=o.length;n<r;n++){const r=o[n];e(t[r],r)}})(e,((t,e)=>{x(o,e,t)}))})(o,n),o})(t,e);return((t,e)=>{const o=(t=>u.from(t.dom.nextSibling).map(V))(t);o.fold((()=>{X(t).each((t=>{ot(t,e)}))}),(t=>{((t,e)=>{X(t).each((o=>{o.dom.insertBefore(e.dom,t.dom)}))})(t,e)}))})(t,o),((t,e)=>{f(e,(e=>{ot(t,e)}))})(o,q(t)),(t=>{const e=t.dom;null!==e.parentNode&&e.parentNode.removeChild(e)})(t),o},rt=(t,e,o)=>et(t,(t=>U(t,e)),o);tinymce.PluginManager.add("checklist",(t=>{((t,o)=>!!t&&-1===((t,o)=>{const n=e(t.major,o.major);if(0!==n)return n;const r=e(t.minor,o.minor);if(0!==r)return r;const s=e(t.patch,o.patch);return 0!==s?s:0})((t=>n((t=>[t.majorVersion,t.minorVersion].join(".").split(".").slice(0,3).join("."))(t)))(t),n(o)))(tinymce,"6.0.0")?console.error("The Checklist Plugin requires at least version 6.0.0 of TinyMCE"):(t.on("init",(()=>{t.hasPlugin("lists",!0)||t.windowManager.alert("Please use the Checklist Plugin together with the Lists plugin.")})),(t=>{t.on("ListMutation",(t=>{const e=u.from(t.element).map(V);"IndentList"===t.action||"OutdentList"===t.action?e.map(_).map((t=>f(((t,e)=>{const o=void 0===e?document:e.dom;return 1!==(n=o).nodeType&&9!==n.nodeType&&11!==n.nodeType||0===n.childElementCount?[]:g(o.querySelectorAll(t),V);var n})("ul",t),(t=>_(t))))):"ToggleUlList"!==t.action&&"ToggleOlList"!==t.action&&"ToggleDLList"!==t.action||e.filter(Z).map((t=>{B(t,"tox-checklist"),f(q(t),(t=>B(t,"tox-checklist--checked")))}))}))})(t),(t=>{const e=t=>"ol"===v(t)||"ul"===v(t),o=()=>{var o,n;(o=V(t.selection.getNode()),n=e,tt(((t,e)=>e(t)),et,o,n,void 0)).fold((()=>{t.execCommand("InsertUnorderedList",!1,{"list-attributes":{class:"tox-checklist"}})}),(e=>{t.undoManager.transact((()=>{if(I(e,"tox-checklist"))t.execCommand("RemoveList");else{const t=nt(e,"ul");E(t,"tox-checklist")}}))}))};t.ui.registry.addToggleButton("checklist",{icon:"checklist",tooltip:"Insert Checklist",onAction:o,onSetup:o=>{const n=V(t.getBody()),r=t=>{return o=n,t.dom===o.dom||e(t);var o},s=e=>o.setActive(!t.readonly&&((t,e,o)=>tt(((t,e)=>U(t,e)),rt,t,".tox-checklist",o))(V(e),0,r).isSome()),i=t=>s(t.element);return t.on("NodeChange",i),s(t.selection.getNode()),()=>t.off("NodeChange",i)}}),t.ui.registry.addMenuItem("checklist",{icon:"checklist",text:"Checklist",onAction:o})})(t),(t=>{t.shortcuts.add("meta+13","Check checklist item",(()=>{const e=t.selection.getSelectedBlocks();f(e,(t=>{const e=V(t);J(e)&&W(e)}))}))})(t),(t=>{const e=(t=>{let e=t;return{get:()=>e,set:t=>{e=t}}})(u.none());t.on("mousedown touchstart",(o=>{const n=V(o.target);!((t,e)=>e.exists((e=>"touchstart"===e.type&&"mousedown"===t.type&&t.timeStamp-e.timeStamp<250)))(o,e.get())&&J(n)&&Q(n,(t=>(t=>"touchstart"===t.type)(t)?t.touches[0].clientX:t.clientX)(o))&&(e.set(u.some(o)),t.undoManager.transact((()=>{o.preventDefault(),W(n)})))}))})(t))}))}();